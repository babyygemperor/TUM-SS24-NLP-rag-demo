<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>LLM Fact Editing</title>
		<style>
			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				background-color: #121212;
				color: #ccc;
				padding: 20px;
			}
			.container {
				max-width: 600px;
				margin: auto;
				background-color: #1e1e1e;
				padding: 20px;
				border-radius: 8px;
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			}
			input,
			textarea,
			button {
				width: 100%;
				box-sizing: border-box;
				padding: 10px;
				margin: 10px 0;
				border-radius: 5px;
				border: 1px solid #333;
				background-color: #333;
				color: #fff;
				font-size: 16px;
			}
			textarea {
				resize: vertical;
			}
			#questionButton,
			#factButton {
				/* Individual button colors */
				background-color: #007bff; /* Blue */
			}
			button {
				background-color: #6c757d; /* Neutral gray */
				transition: background-color 0.5s;
			}
			button:not(:disabled) {
				cursor: pointer;
			}
			button:hover {
				opacity: 0.8;
			}
			*:disabled {
				opacity: 0.5;
			}
			.response,
			.size-display {
				background-color: #252526;
				padding: 10px;
				border-radius: 5px;
				margin-top: 10px;
				color: #ddd;
				font-size: 16px;
			}
			.loading-spinner {
				border: 4px solid #f3f3f3;
				border-top: 4px solid #3498db;
				border-radius: 50%;
				width: 20px;
				height: 20px;
				animation: spin 2s linear infinite;
				display: block;
				margin: 10px auto;
			}
			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
			.size-display {
				position: fixed;
				right: 20px;
				top: 20px;
				font-size: 25px; /* Increased font size */
				font-weight: bold; /* Make it bold */
				transition: transform 0.5s ease;
			}
			.size-changed {
				transform: scale(1.5); /* Blow up size */
			}
			.response {
				display: none;
			}
			.response.show {
				display: block;
			}
			.response.success {
				animation: flashGreen 1s;
			}
			.response.error {
				animation: flashRed 1s;
			}
			@keyframes flashGreen {
				from {
					background-color: #28a745;
				}
			}
			@keyframes flashRed {
				from {
					background-color: #dc3545;
				}
			}
		</style>
	</head>
	<body>
		<div class="size-display" id="vectorSizeDisplay">
			Vector Store Size: <span id="vectorSize">0</span>
		</div>
		<div class="container">
			<h1>LLM Fact Editing</h1>

			<h2>Ask a Question</h2>
			<input
				type="text"
				id="questionInput"
				placeholder="Enter a question"
				onkeypress="enterSubmit(event, 'questionButton')"
                onclick="selectText(this)"
			/>
			<button id="questionButton" onclick="submitQuestion()">
				Submit Question
			</button>
			<div id="questionResponse" class="response"></div>

			<h2>Add a Fact</h2>
			<textarea
				id="factInput"
				placeholder="Enter a fact to add"
				onkeypress="enterSubmit(event, 'factButton')"
			></textarea>
			<button id="factButton" onclick="addFact()">Add Fact</button>
			<div id="factResponse" class="response"></div>

			<h2>Reset Vector Store</h2>
			<button id="resetButton" onclick="resetVectors()">Reset Vectors</button>
			<div id="resetResponse" class="response"></div>
		</div>

		<script>
			const MSG_TIME = 2000;

			function selectText(element) {
				element.select();
			}

			function enterSubmit(event, buttonId) {
				if (event.keyCode === 13) {
					event.preventDefault(); // Prevent form submission
					document.getElementById(buttonId).click();
				}
			}

			async function postData(url = '', data = {}, shouldUpdateSize = true) {
				const response = await fetch('https://rag-api.aamin.dev' + url, {
					method: 'POST',
					mode: 'cors',
					cache: 'no-cache',
					credentials: 'same-origin',
					headers: {
						'Content-Type': 'application/json',
					},
					redirect: 'follow',
					referrerPolicy: 'no-referrer',
					body: JSON.stringify(data),
				});
				if (shouldUpdateSize) {
					updateSize();
				}
				return response;
			}

			async function getData(url = '') {
				const response = await fetch('https://rag-api.aamin.dev' + url);
				return response.json();
			}

			function submitQuestion() {
				const questionInput = document.getElementById('questionInput');
				const questionButton = document.getElementById('questionButton');
				const questionResponse = document.getElementById('questionResponse');
				questionInput.disabled = true;
				questionButton.disabled = true;
				questionResponse.innerHTML = '<div class="loading-spinner"></div>';
				questionResponse.classList.add('show');
				postData('/ask_question', { question: questionInput.value }, false)
					.then((response) => response.json())
					.then((data) => {
						questionResponse.textContent = `${data.RAG ? 'No' : ''} RAG: ${
							data.answer
						}`;
						questionResponse.classList.add('success');
					})
					.catch(() => {
						questionResponse.textContent = 'Failed to ask question.';
						questionResponse.classList.add('error');
					})
					.finally(() => {
						setTimeout(() => {
							questionInput.disabled = false;
							questionButton.disabled = false;
							questionResponse.classList.remove('success');
							questionResponse.classList.remove('error');
						}, 1000);
					});
			}

			function addFact() {
				const factInput = document.getElementById('factInput');
				const factButton = document.getElementById('factButton');
				const factResponse = document.getElementById('factResponse');
				factResponse.innerHTML = '<div class="loading-spinner"></div>';
				factInput.disabled = true;
				factButton.disabled = true;
				factResponse.classList.add('show');
				postData('/add_fact', { fact: factInput.value })
					.then((response) => {
						if (response.ok) {
							response.json().then((data) => {
								factResponse.classList.add('success');
								factResponse.textContent = data.message;
							});
						} else {
							factResponse.textContent = 'Error: Unable to add fact.';
							factResponse.classList.add('error');
						}
					})
					.catch(() => {
						factResponse.textContent = 'Error: Unable to add fact.';
						factResponse.classList.add('error');
					})
					.finally(() => {
						setTimeout(() => {
							factResponse.classList.remove('success');
							factResponse.classList.remove('error');
							factResponse.classList.remove('show');
							factInput.disabled = false;
							factButton.disabled = false;
							factInput.value = '';
						}, MSG_TIME);
					});
			}

			function resetVectors() {
				const resetButton = document.getElementById('resetButton');
				const resetResponse = document.getElementById('resetResponse');
				resetResponse.innerHTML = '<div class="loading-spinner"></div>';
				resetResponse.classList.add('show');
				resetButton.disabled = true;
				postData('/reset_vectors', { reset: true })
					.then((response) => {
						if (response.ok) {
							resetResponse.classList.add('success');
							resetResponse.innerHTML = 'Reset successful';
						} else {
							resetResponse.classList.add('error');
							resetResponse.innerHTML = 'Reset failed';
						}
					})
					.catch(() => {
						resetResponse.classList.add('error');
						resetResponse.innerHTML = 'Reset failed';
					})
					.finally(() => {
						setTimeout(() => {
							resetButton.disabled = false;
							resetResponse.classList.remove('success');
							resetResponse.classList.remove('error');
							resetResponse.classList.remove('show');
						}, MSG_TIME);
					});
			}

			function updateSize() {
				const vectorSizeDisplay = document.getElementById('vectorSizeDisplay');
				getData('/size').then((data) => {
					document.getElementById('vectorSize').textContent = data.size;
					vectorSizeDisplay.classList.add('size-changed');
					setTimeout(() => {
						vectorSizeDisplay.classList.remove('size-changed');
					}, 500); // Animation reset
				});
			}

			// Call getSize on page load
			window.onload = updateSize;
		</script>
	</body>
</html>
